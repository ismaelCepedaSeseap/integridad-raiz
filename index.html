<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integridad desde la Raíz - SESEA PUEBLA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/index.css">
</head>

<body class="bg-slate-50">

    <header id="inicio" class="overflow-hidden relative">
        <div id="slider-track" class="flex transition-transform duration-700 ease-in-out">
        </div>
        <div id="slider-dots" class="absolute bottom-10 left-1/2 -translate-x-1/2 flex gap-2 z-10">
        </div>

        <!-- Botones de Navegación Manual -->
        <button onclick="prevSlideManual()"
            class="absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/20 hover:bg-white/40 backdrop-blur-md border border-white/30 rounded-full flex items-center justify-center text-slate-700 hover:text-white transition-all shadow-lg z-20 group">
            <i data-lucide="chevron-left" class="w-8 h-8 group-hover:scale-110 transition-transform"></i>
        </button>
        <button onclick="nextSlideManual()"
            class="absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/20 hover:bg-white/40 backdrop-blur-md border border-white/30 rounded-full flex items-center justify-center text-slate-700 hover:text-white transition-all shadow-lg z-20 group">
            <i data-lucide="chevron-right" class="w-8 h-8 group-hover:scale-110 transition-transform"></i>
        </button>
    </header>

    <section class="bg-slate-50 border-b border-slate-200">
        <div class="w-full max-w-[90%] mx-auto px-4 text-center">

            <div id="states-container">
                <!-- El contenido se cargará dinámicamente desde js/region-logic.js -->
            </div>
        </div>
    </section>

    <section id="actividades" class="py-24 bg-green-900 text-white relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-6 relative z-10">
            <div class="flex flex-col lg:flex-row items-center gap-16">
                <div class="lg:w-1/2">
                    <h2 class="text-4xl font-bold mb-6">El Árbol de la Integridad</h2>
                    <p class="text-green-100 text-lg mb-10">Haz clic en los frutos dorados para descubrir consejos y
                        acciones positivas.</p>
                    <div id="tip-display"
                        class="bg-white/10 backdrop-blur-md p-10 rounded-[40px] border border-white/20 min-h-[200px] flex items-center justify-center text-center italic text-xl transition-all duration-500">
                        "¡Selecciona una semilla del árbol para comenzar!"
                    </div>
                </div>
                <div class="lg:w-1/2 flex justify-center">
                    <div class="relative w-full max-w-sm aspect-square">
                        <svg viewBox="0 0 200 200" class="w-full h-full drop-shadow-2xl">
                            <path d="M100 180 Q100 140 100 100" stroke="#523015" stroke-width="12"
                                stroke-linecap="round" />
                            <circle cx="100" cy="80" r="50" fill="#15803d" />
                            <circle cx="70" cy="100" r="40" fill="#166534" />
                            <circle cx="130" cy="100" r="40" fill="#166534" />
                            <circle onclick="showTip('honestidad')" cx="80" cy="75" r="8" fill="#facc15"
                                class="seed-pulse" />
                            <circle onclick="showTip('respeto')" cx="120" cy="85" r="8" fill="#facc15"
                                class="seed-pulse" />
                            <circle onclick="showTip('justicia')" cx="100" cy="110" r="8" fill="#facc15"
                                class="seed-pulse" />
                            <circle onclick="showTip('responsabilidad')" cx="100" cy="55" r="8" fill="#facc15"
                                class="seed-pulse" />
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="cine" class="py-24 bg-white" style="padding-top: 2rem;padding-bottom: 3rem;">
        <div class="max-w-7xl mx-auto px-6">
            <div class="text-center mb-16">
                <div class="inline-block p-3 bg-yellow-100 rounded-2xl text-yellow-600 mb-4"><i data-lucide="film"
                        class="w-8 h-8"></i></div>
                <h2 class="text-4xl md:text-5xl font-black text-slate-900 mb-4 italic uppercase">Cine de la Integridad
                </h2>
                <p class="text-slate-500 text-lg max-w-2xl mx-auto">Nuestros guardianes tienen un mensaje especial para
                    ti. ¡Dale play!</p>
            </div>
            <div id="cine-container" class="grid gap-12 lg:gap-24">
                <!-- El contenido se cargará dinámicamente desde js/cine-data.js -->
            </div>
        </div>
    </section>


    <!-- SECCIÓN: ÚLTIMO EVENTO -->
    <section id="ultimo-evento" class="py-24 px-6 bg-slate-100 border-y border-slate-200">
        <div id="event-container" class="max-w-7xl mx-auto">
            <!-- El contenido se cargará dinámicamente desde js/event-data.js -->
        </div>
    </section>

    <section id="muro" class="py-24 bg-slate-50">
        <div class="max-w-7xl mx-auto px-6">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-black text-slate-900 italic">Muro de Compromisos</h2>
                <p class="text-slate-500 mt-2">Comparte tu compromiso para un país más íntegro.</p>
            </div>
            <section class="grid grid-cols-1 lg:grid-cols-6 gap-8 items-center">
                <div class="lg:col-span-3">
                    <div
                        class="bg-white p-8 rounded-[30px] shadow-lg border-2 border-dashed border-green-300 sticky top-10 relative">
                        <!-- Velo de procesamiento -->
                        <div id="loading-overlay">
                            <div
                                class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-green-600 mb-4">
                            </div>
                            <p class="text-green-800 font-bold text-lg animate-pulse">Procesando tu compromiso...</p>
                        </div>

                        <h3 class="text-2xl text-green-700 mb-6 text-center font-black">¡Participa!</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <input type="text" id="c-name" placeholder="Tu nombre"
                                class="p-4 rounded-2xl bg-slate-50 border border-slate-200 focus:outline-none focus:ring-2 focus:ring-green-400">
                            <select id="c-location"
                                class="p-4 rounded-2xl bg-slate-50 border border-slate-200 focus:outline-none focus:ring-2 focus:ring-green-400 text-slate-500">
                                <option value="">Selecciona tu estado</option>
                            </select>
                        </div>
                        <textarea id="c-text" placeholder="Escribe tu compromiso aquí..."
                            class="w-full p-4 rounded-2xl bg-slate-50 border border-slate-200 h-32 mb-4 focus:outline-none focus:ring-2 focus:ring-green-400"></textarea>

                        <!-- CAPTCHA Section -->
                        <div class="px-2 mb-2 flex justify-between items-end">
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Validación Humana</span>
                            <span id="captchaError"
                                class="text-[10px] font-bold text-red-500 hidden uppercase tracking-widest">Código Incorrecto</span>
                        </div>

                        <div class="mb-4 p-3 bg-slate-100 rounded-2xl border-2 border-dashed border-slate-300">
                            <div class="flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4">
                                <div class="flex items-center gap-2">
                                    <div class="relative group">
                                        <canvas id="captchaCanvas" width="120" height="40" onclick="generateCaptcha()"
                                            class="rounded-xl border-2 border-slate-200 bg-white cursor-pointer"></canvas>
                                        <div class="absolute -top-1 -right-1 bg-green-500 w-3 h-3 rounded-full border-2 border-white"></div>
                                    </div>
                                    <button type="button" onclick="generateCaptcha()"
                                        class="p-2 text-slate-400 hover:text-green-600 transition-colors">
                                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                                    </button>
                                </div>
                                <input type="text" id="captchaInput" placeholder="Código"
                                    class="w-full sm:w-40 md:w-48 lg:w-56 p-3 text-center rounded-xl border-2 border-slate-200 focus:border-green-500 outline-none text-sm font-bold text-slate-700 uppercase bg-white"
                                    required autocomplete="off">
                            </div>
                        </div>

                        <button onclick="addPost(this)"
                            class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-xl shadow-lg transform active:scale-95 transition-all flex items-center justify-center gap-2">
                            <i data-lucide="send" class="w-4 h-4"></i>
                            <span>Publicar Compromiso</span>
                        </button>
                    </div>
                </div>
                <div class="lg:col-span-3">
                    <div class="flex items-center justify-between mb-8">
                        <span id="posts-counter"
                            class="bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-bold">0 compromisos
                            publicados</span>
                    </div>
                    <div id="posts-container" class="space-y-8 max-h-[600px] overflow-y-auto pr-4"></div>
                    <div id="pagination-controls" class="flex items-center justify-between mt-8"></div>
                </div>
            </section>
        </div>
    </section>



    <div id="lightbox" onclick="closeLightbox()">
        <button class="absolute top-10 right-10 text-white hover:text-green-400 transition"><i data-lucide="x-circle"
                class="w-12 h-12"></i></button>
        <img id="lightbox-img" src="" class="max-w-[90%] max-h-[85vh] rounded-xl border-4 border-white/20 shadow-2xl"
            alt="Vista Ampliada">
    </div>

    <script src="js/footer.js"></script>
    <script src="js/menu.js"></script>
    <script src="js/states-data.js"></script>
    <script src="js/region-logic.js"></script>
    <script src="js/slider-data.js"></script>
    <script src="js/slider-logic.js"></script>
    <script src="js/cine-data.js"></script>
    <script src="js/cine-logic.js"></script>
    <script src="js/events-data.js"></script>
    <script src="js/event-data.js"></script>
    <script src="js/event-logic.js"></script>
    <script src="js/form-states-data.js"></script>
    <script src="js/form-states-logic.js"></script>
    <script src="js/muro-data.js"></script>
    <script src="js/muro-logic.js"></script>
    <script src="assets/js/generales/captcha.js"></script>
    <script>
        lucide.createIcons();

        // Árbol de la Integridad (Tips)
        const tips = {
            honestidad: "Si encuentras algo que no es tuyo, busca a su dueño para regresarlo. ¡La verdad nos hace grandes!",
            respeto: "Escucha a los demás con atención. Todas las ideas son importantes para crecer juntos.",
            justicia: "Sigue las reglas para que todos se diviertan por igual. ¡Sé justo siempre!",
            responsabilidad: "Cuidar tus libros y tu escuela es tarea de todos. ¡Tus pequeñas acciones cuentan!"
        };

        function showTip(type) {
            const display = document.getElementById('tip-display');
            display.style.opacity = '0';
            setTimeout(() => {
                display.innerHTML = `<div><strong class="text-green-500 block mb-2 uppercase tracking-widest text-sm">${type}</strong><p>"${tips[type]}"</p></div>`;
                display.style.opacity = '1';
                display.classList.add('bg-green-800/40');
            }, 200);
        }

        // Banners (Scroll horizontal)
        function scrollBanners(dir) {
            const container = document.getElementById('banner-scroll');
            container.scrollLeft += dir === 'left' ? -350 : 350;
        }

        // Galería (Ver más fotos)
        function toggleGallery() {
            const photos = document.querySelectorAll('.hidden-photo');
            const btn = document.getElementById('btn-text');
            const isShowing = photos[0].style.display === 'block';
            photos.forEach(p => p.style.display = isShowing ? 'none' : 'block');
            btn.innerText = isShowing ? "Ver todas las fotos" : "Ver menos";
        }

        // Lightbox (Visualizador)
        function openLightbox(src) {
            document.getElementById('lightbox-img').src = src;
            document.getElementById('lightbox').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        function closeLightbox() {
            document.getElementById('lightbox').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        async function obtenerDatosPHP(formData) {
            try {
                const respuesta = await fetch("assets/php/gemini.php", {
                    method: "POST",
                    body: formData
                });
                return await respuesta.json();
            } catch (error) {
                console.error(error);
                Swal.fire("Error", "No se pudo conectar con el servidor de validación.", "error");
            }
        }

        async function addPost(btn) {
            const overlay = document.getElementById('loading-overlay');
            const nameInput = document.getElementById('c-name');
            const locationInput = document.getElementById('c-location');
            const textInput = document.getElementById('c-text');
            const captchaInput = document.getElementById('captchaInput');
            const captchaError = document.getElementById('captchaError');
            const name = nameInput.value.trim();
            const location = locationInput.value.trim();
            const text = textInput.value.trim();
            const captchaVal = (captchaInput?.value || "").trim().toUpperCase();

            if (!name || !text || !location) {
                Swal.fire("Atención", "Por favor completa todos los campos del compromiso.", "warning");
                return;
            }

            if (!captchaVal || captchaVal !== currentCaptcha) {
                if (captchaError) captchaError.classList.remove('hidden');
                Swal.fire("CAPTCHA Incorrecto", "Por favor escribe correctamente el código.", "error");
                generateCaptcha();
                return;
            }

            overlay.style.display = "flex";
            btn.style.display = "none";

            try {
                const formData = new FormData();
                formData.append("nombre", name);
                formData.append("estado", location);
                formData.append("compromiso", text);

                const aprobado = await obtenerDatosPHP(formData);

                if (aprobado && aprobado.output && aprobado.output.candidates) {
                    const rawText = aprobado.output.candidates[0].content.parts[0].text;
                    const contenido = JSON.parse(rawText.replace(/```json|```/g, "").trim());

                    if (contenido.veredicto_final == "ACEPTADO") {
                        const card = document.createElement('div');
                        card.className = "bg-white p-5 sm:p-7 rounded-[24px] shadow-md flex flex-col sm:flex-row gap-4 animate-fade-in-up w-full overflow-hidden";

                        const colors = ['red', 'blue', 'green', 'yellow', 'purple'];
                        const avatarColor = colors[Math.floor(Math.random() * colors.length)];

                        card.innerHTML = `
                            <div class="flex-shrink-0 w-12 h-12 rounded-full bg-${avatarColor}-200 flex items-center justify-center text-slate-700 font-bold text-lg border-2 border-white shadow-sm">
                                ${name.charAt(0).toUpperCase()}
                            </div>
                            <div class="flex-grow min-w-0">
                                <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-2 mb-2 min-w-0">
                                    <h4 class="font-bold text-slate-800 text-lg sm:text-xl break-words leading-tight min-w-0">${name}</h4>
                                    <div class="flex flex-wrap items-center gap-2">
                                        <span class="inline-flex items-center gap-1 bg-green-100 text-green-700 px-3 py-1 rounded-full text-[11px] sm:text-xs font-bold uppercase tracking-wide max-w-full">
                                            <i data-lucide="map-pin" class="w-4 h-4"></i>
                                            <span class="break-words">${location}</span>
                                        </span>
                                    </div>
                                </div>
                                <p class="text-slate-600 italic text-sm sm:text-base break-words">"${text}"</p>
                            </div>
                        `;
                        document.getElementById('posts-container').prepend(card);
                        lucide.createIcons();

                        // Actualizar contador
                        const counter = document.getElementById('posts-counter');
                        const currentCount = parseInt(counter.innerText.split(' ')[0]);
                        counter.innerText = `${currentCount + 1} compromisos publicados`;

                        nameInput.value = "";
                        locationInput.value = "";
                        textInput.value = "";

                        Swal.fire("¡Éxito!", "Tu compromiso ha sido validado y publicado.", "success");
                        generateCaptcha();
                    } else {
                        let mensajeError = "";
                        if (contenido.nombre_valido === false) mensajeError += "• No se aceptan nombres con doble sentido o albures.\\n";
                        if (contenido.estado_valido === false) mensajeError += "• El estado ingresado no es válido en México.\\n";
                        if (contenido.compromiso_valido === false) mensajeError += "• Solo se aceptan compromisos serios y constructivos.\\n";
                        Swal.fire({
                            icon: "error",
                            title: "Validación Fallida",
                            text: mensajeError || "El contenido no cumple con las reglas de integridad."
                        });
                        generateCaptcha();
                    }
                }
            } catch (e) {
                console.error(e);
                Swal.fire("Error", "Ocurrió un problema al procesar la solicitud.", "error");
                generateCaptcha();
            } finally {
                overlay.style.display = "none";
                btn.style.display = "";
            }
        }

        document.addEventListener('DOMContentLoaded', generateCaptcha);
    </script>
</body>

</html>
